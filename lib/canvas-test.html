<!DOCTYPE html>
<html>
<body>

<canvas id="myCanvas" width="400" height="400" style="border:1px solid #000000;"></canvas>

<script>

var timeToPosition = function(time) {
	return (time.hours % 12)/12 + time.minutes/12/60 + time.seconds/12/60/60;
};
var positionToTime = function(position) {
	var time = {};
    
    var hours = position * 12;
    time.hours = Math.floor(hours);
    
    var minutes = (hours - time.hours) * 60;
    time.minutes = Math.floor(minutes);
    
    var seconds = (minutes - time.minutes) * 60;
    time.seconds = Math.round(seconds);
    
    return time;
};

var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");

var currentPosition = null;

var drawTime = function(time) {
	currentPosition = timeToPosition(time);
    
	ctx.save();
    ctx.clearRect(0, 0, 400, 400);
	ctx.translate(200, 200);
	ctx.rotate(-Math.PI/2);
    
    var hoursAngle = 2*Math.PI * currentPosition;
    var minutesAngle = 2*Math.PI * 12 * timeToPosition({hours:0, minutes: time.minutes, seconds: time.seconds});
    
	ctx.beginPath();
	ctx.lineWidth = 50;
	ctx.arc(0, 0, 100, hoursAngle, minutesAngle);
	ctx.stroke();

	ctx.restore();
};

var drawCurrentTime = function() {
	var now = new Date();
    drawTime({hours:now.getHours(), minutes:now.getMinutes(), seconds:now.getSeconds()});
};

var drawLogo = function() {
	drawTime({hours:5, minutes:4, seconds:40});
	//drawTime(4, 09, 15);
};

var animateCurrentTime = function() {
	drawCurrentTime();
    window.requestAnimationFrame(animateCurrentTime);
};

var transition = {};
var transitionTo = function(newEndTime) {
	console.log('calling transition to', newEndTime);
    // Time to make an entire revolution
    var revolutionDuration = 10000;
    
	var now = Date.now();
    
	if (newEndTime) {
    	// New transition
        transition.startPosition = currentPosition;
        transition.endPosition = timeToPosition(newEndTime);
        transition.startAt = now;
        transition.duration = Math.abs(transition.startPosition - transition.endPosition) * revolutionDuration;
    }
    
    // How far are we in the transition?
    var progress = Math.max(0, Math.min((now - transition.startAt) / transition.duration, 1));
    
    var forward = transition.endPosition > transition.startPosition;
    var nextPosition = transition.startPosition + (forward ? 1 : -1) * progress * Math.abs(transition.startPosition - transition.endPosition);
    var nextTime = positionToTime(nextPosition);
    
    console.log(nextTime);
    
    drawTime(nextTime);
    if (progress < 1) {
    	window.requestAnimationFrame(transitionTo.bind(null, null));
    }
};



//animateCurrentTime();

drawCurrentTime();

setTimeout(function() {
	//transitionTo({hours:5, minutes:4, seconds:40});
}, 2000);




//window.requestAnimationFrame(drawCurrentTime);

</script>

</body>
</html>
